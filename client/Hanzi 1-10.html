<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Hanzi SRS â€” Hanzi Levels 1â€“10" />
  <meta name="theme-color" content="#0b0f19" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <title>Hanzi SRS â€” Hanzi Levels 1â€“10</title>

  <style>
    /* ---------- Reset & tokens ---------- */
    *,*::before,*::after{box-sizing:border-box}
    body,h1,h2,h3,h4,p,figure,blockquote,dl,dd{margin:0}
    img,svg,video,canvas{display:block;max-width:100%}
    input,button,textarea,select{font:inherit}
    :root{color-scheme:dark light}
    :root{
      /* dark defaults */
      --bg:#0b0f19; --bg-2:#0e1423; --text:#e5e7eb; --muted:#98a2b3;
      --surface:rgba(255,255,255,.04); --surface-2:rgba(255,255,255,.06); --border:rgba(255,255,255,.12);
      --accent:hsl(257 90% 66%); --accent-2:hsl(190 90% 60%);
      --ok:#22c55e; --warn:#f59e0b;
      --shadow:0 10px 30px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.2);

      --container:1200px; --radius:16px; --gap:18px;
      --navH:64px;           /* sticky nav height */
      --lvlHeadH:52px;       /* level bar height (consistent) */
      --tile:88px; --tileFont:36px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f8fb; --bg-2:#eef2f8; --text:#0b1220; --muted:#667085;
        --surface:#ffffff; --surface-2:#f3f6fb; --border:#d7dee9;
        --shadow:0 10px 30px rgba(11,18,32,.08), 0 2px 8px rgba(11,18,32,.06);
      }
    }
    html[data-theme="light"]{
      --bg:#f6f8fb; --bg-2:#eef2f8; --text:#0b1220; --muted:#667085;
      --surface:#ffffff; --surface-2:#f3f6fb; --border:#d7dee9;
      --shadow:0 10px 30px rgba(11,18,32,.08), 0 2px 8px rgba(11,18,32,.06);
    }
    html[data-theme="dark"]{
      --bg:#0b0f19; --bg-2:#0e1423; --text:#e5e7eb; --muted:#98a2b3;
      --surface:rgba(255,255,255,.04); --surface-2:rgba(255,255,255,.06); --border:rgba(255,255,255,.12);
    }

    body{
      min-height:100vh; background:var(--bg); color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", "PingFang SC","Hiragino Sans GB","Microsoft YaHei","Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility; line-height:1.55;
    }
    .bg{position:fixed; inset:0; z-index:-1; background:
      radial-gradient(1000px 420px at 85% -10%, color-mix(in oklab, var(--accent), transparent 76%), transparent 75%),
      radial-gradient(900px 360px at 0% 0%, color-mix(in oklab, var(--accent-2), transparent 82%), transparent 75%),
      linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 40%, var(--bg) 100%)}
    .bg::after{content:""; position:absolute; inset:-1px; opacity:.25; background:
      linear-gradient(transparent 97%, var(--border) 100%) 0 0/40px 40px,
      linear-gradient(90deg, transparent 97%, var(--border) 100%) 0 0/40px 40px;
      mask-image: radial-gradient(80% 60% at 50% 10%, #000 0%, #000 60%, transparent 85%)}

    .container{max-width:var(--container); margin-inline:auto; padding-inline:clamp(16px,3vw,32px)}
    .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .stack{display:flex; flex-direction:column; gap:10px}

    /* ---------- Nav ---------- */
    .nav{position:sticky; top:0; z-index:60; backdrop-filter: blur(12px);
      background: color-mix(in oklab, var(--bg), transparent 55%); border-bottom:1px solid var(--border)}
    .nav-inner{height:var(--navH); display:flex; align-items:center; justify-content:space-between}
    .brand{display:flex; gap:10px; align-items:center; color:inherit; text-decoration:none; font-weight:900}
    .brand-badge{width:32px; height:32px; display:grid; place-items:center; border-radius:10px; color:#fff;
      background:linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow:var(--shadow)}
    .btn{display:inline-flex; align-items:center; gap:10px; border:1px solid var(--border); background:var(--surface);
      padding:10px 14px; border-radius:12px; color:var(--text); text-decoration:none; cursor:pointer; font-weight:800; transition:transform .15s ease}
    .btn:hover{transform:translateY(-1px)} .btn:active{transform:none}

    /* ---------- Hero / toolbar ---------- */
    .panel{background:linear-gradient(180deg, var(--surface-2), transparent); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:16px}
    h1{font-size:clamp(1.35rem, 2.2vw, 1.8rem); font-weight:900}
    .muted{color:var(--muted)}
    .pill{padding:6px 10px; border:1px solid var(--border); border-radius:999px}
    .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .field{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px; border:1px solid var(--border); background:var(--surface)}
    .seg{display:inline-flex; gap:8px}
    .seg button{padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:var(--surface); color:var(--text); cursor:pointer; font-weight:800}
    .seg button[aria-pressed="true"]{background:linear-gradient(90deg, var(--accent), var(--accent-2)); color:#fff; border:none}

    /* Level jump chips */
    .chips{display:grid; gap:8px; grid-template-columns: repeat(auto-fill, minmax(46px, 1fr))}
    .chip{display:inline-flex; justify-content:center; align-items:center; padding:10px 0; border-radius:12px; border:1px solid var(--border); background:var(--surface); color:var(--text); text-decoration:none; font-weight:800}

    /* ---------- Level groups (NO OVERLAP; STABLE HEADER) ---------- */
    .level{
      position:relative;
      padding-top:var(--lvlHeadH);     /* reserve space for sticky header */
      margin-top:16px;
      border:1px solid var(--border); border-radius:16px;
      background:var(--surface); box-shadow:var(--shadow);
      overflow:clip;
      scroll-margin-top: calc(var(--navH) + 10px);
    }
    .level-head{
      position:sticky;
      top:calc(var(--navH) + 8px);     /* sit just below nav */
      z-index:20;
      height:var(--lvlHeadH);
      margin-top:calc(-1 * var(--lvlHeadH));  /* visually aligns with reserved space */
      padding:0 14px;
      display:flex; align-items:center; justify-content:space-between;
      background:linear-gradient(180deg, color-mix(in oklab, var(--bg), transparent 4%), color-mix(in oklab, var(--bg), transparent 12%));
      border-bottom:1px solid var(--border);
      backdrop-filter: blur(8px);
    }
    .level-title{display:flex; align-items:center; gap:10px; font-weight:900}
    .lvl-actions{display:flex; gap:8px}
    .mini{padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:var(--surface); color:var(--text); font-weight:800; cursor:pointer}
    .mini:hover{transform:translateY(-1px)}
    .progress{display:flex; align-items:center; gap:8px}
    .pbar{width:120px; height:8px; border-radius:999px; background:var(--surface-2); border:1px solid var(--border); overflow:hidden}
    .pbar > span{display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent-2))}

    .grid{
      display:grid; gap:10px; padding:14px;
      grid-template-columns: repeat(auto-fill, minmax(var(--tile), 1fr));
    }

    /* ---------- Tiles ---------- */
    .tile{
      --ring:transparent;
      position:relative; display:flex; align-items:center; justify-content:center;
      min-height:var(--tile); border:1px solid var(--border); border-radius:14px;
      background:var(--surface); color:var(--text); box-shadow: inset 0 0 0 2px var(--ring);
      cursor:pointer; user-select:none; transition:border-color .15s, transform .10s, background .15s;
      text-decoration:none;
    }
    .tile:hover{transform:translateY(-1px); border-color:color-mix(in oklab, var(--accent), transparent 65%)}
    .glyph{font-size:var(--tileFont); font-weight:900; line-height:1; padding:6px 4px}
    .tick{position:absolute; top:6px; right:6px; width:20px; height:20px; display:grid; place-items:center; border-radius:7px; border:1px solid var(--border); background:var(--bg-2); color:var(--muted); font-size:12px}
    .meter{height:6px; width:80%; margin:8px auto 6px; border-radius:999px; border:1px solid var(--border); background:var(--surface-2); overflow:hidden; position:absolute; bottom:4px; left:50%; transform:translateX(-50%)}
    .meter span{display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent-2))}
    .tile.learned{--ring: color-mix(in oklab, var(--ok), transparent 65%)}
    .tile.locked{opacity:.55; cursor:not-allowed}
    .tile.locked .tick{background:var(--bg-2); color:var(--muted)}
    .tile.locked::after{content:""; position:absolute; inset:0; border-radius:14px; background:repeating-linear-gradient(45deg, transparent 0 8px, rgba(0,0,0,.05) 8px 16px)}

    /* Dock (back to top & compact) */
    .dock{position:fixed; right:18px; bottom:18px; z-index:50; display:flex; flex-direction:column; gap:10px}
    .to-top{opacity:0; pointer-events:none; transition:opacity .2s ease}
    .to-top.show{opacity:1; pointer-events:auto}

    footer{border-top:1px solid var(--border); margin-top:26px; padding:22px 0; color:var(--muted)}
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>

  <!-- NAV -->
  <nav class="nav" aria-label="Primary">
    <div class="container nav-inner">
      <a class="brand" href="index.html" aria-label="Back to dashboard">
        <span class="brand-badge" aria-hidden="true">æ±‰</span>
        <span>Hanzi SRS</span>
        <span class="pill">Levels</span>
      </a>
      <div class="row">
        <a class="btn" href="reviews.html">Reviews</a>
        <a class="btn" href="lessons.html">Lessons</a>
        <button id="themeBtn" class="btn" aria-label="Toggle theme">
          <svg id="themeIcon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3v2m0 14v2m9-9h-2M5 12H3m14.95 6.95-1.41-1.41M7.46 7.46 6.05 6.05m12.9 0-1.41 1.41M7.46 16.54l-1.41 1.41" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          Theme
        </button>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <main class="container" style="margin-top:18px">
    <section class="panel">
      <div class="row" style="justify-content:space-between; align-items:flex-start">
        <div class="stack">
          <h1>Hanzi Â· Levels <span id="rangeFrom">1</span>â€“<span id="rangeTo">10</span></h1>
          <p class="muted">Premium, simple browsing. Clean spacing, persistent section headers, fast scanning.</p>
        </div>
        <div class="row">
          <span class="pill">Items <b id="itemCount">â€”</b></span>
          <span class="pill">Level <b id="lvlFrom">1</b>â€“<b id="lvlTo">10</b></span>
        </div>
      </div>

      <div class="toolbar" style="margin-top:10px">
        <label class="field" title="Filter by study status">
          <span class="muted">Status</span>
          <select id="statusSel" style="background:transparent;border:none;color:inherit;outline:none">
            <option value="all">All</option>
            <option value="new">Unseen</option>
            <option value="learn">In progress</option>
            <option value="done">Learned</option>
          </select>
        </label>
        <label class="field" title="Tile size"><input id="bigTiles" type="checkbox"> Larger tiles</label>
        <div class="seg" role="tablist" aria-label="Sort order">
          <button id="sortLevel" aria-pressed="true">By level</button>
          <button id="sortAlpha" aria-pressed="false">By stroke/alpha</button>
        </div>
        <div class="seg" role="group" aria-label="Section controls">
          <button id="expandAll" class="btn" style="padding:8px 12px">Expand all</button>
          <button id="collapseAll" class="btn" style="padding:8px 12px">Collapse all</button>
        </div>
      </div>

      <div class="chips" style="margin-top:12px" id="levelJump"></div>
    </section>

    <!-- Levels render here -->
    <div id="levelsWrap"></div>
  </main>

  <!-- Docked controls -->
  <div class="dock">
    <button id="compactBtn" class="btn" title="Compact spacing">Compact</button>
    <a id="toTop" class="btn to-top" href="#" aria-label="Back to top">â†‘ Top</a>
  </div>

  <footer class="container">
    <div class="row" style="justify-content:space-between">
      <span class="muted">Â© <span id="year"></span> Hanzi SRS</span>
      <span class="muted">Headers are stable (never auto-hide). Smooth and predictable.</span>
    </div>
  </footer>

  <script>
    /* ------ Theme ------ */
    const THEME_KEY='hanziSRS_theme';
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    function applyTheme(next){
      localStorage.setItem(THEME_KEY, next);
      document.documentElement.setAttribute('data-theme', next==='auto' ? (prefersDark?'dark':'light') : next);
      document.getElementById('themeIcon').innerHTML =
        (document.documentElement.getAttribute('data-theme')==='dark')
          ? '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z" stroke="currentColor" stroke-width="2" fill="none"/>'
          : '<path d="M12 3v2m0 14v2m9-9h-2M5 12H3m14.95 6.95-1.41-1.41M7.46 7.46 6.05 6.05m12.9 0-1.41 1.41M7.46 16.54l-1.41 1.41" stroke="currentColor" stroke-width="2" fill="none"/>';
    }
    function initTheme(){ applyTheme(localStorage.getItem(THEME_KEY) || 'auto') }
    document.getElementById('themeBtn').addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme') || (prefersDark?'dark':'light');
      applyTheme(cur==='dark' ? 'light' : 'dark');
    });

    /* ------ Params (defaults to 1â€“10) ------ */
    const params = new URLSearchParams(location.search);
    const from = parseInt(params.get('from') || '1', 10);
    const to   = parseInt(params.get('to')   || '10', 10);
    document.getElementById('year').textContent = new Date().getFullYear();
    document.getElementById('rangeFrom').textContent = from;
    document.getElementById('rangeTo').textContent = to;
    document.getElementById('lvlFrom').textContent = from;
    document.getElementById('lvlTo').textContent = to;

    /* ------ Demo dataset (replace with real) ------ */
    const baseChars = [..."ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åäººå£å¥³å­å¤§å°ä¸Šä¸‹å·¦å³ä¸­æ—¥æœˆæ°´ç«åœŸæœ¨ç”°ç›®å£å¿ƒæ‰‹è¶³å±±çŸ³ç«¹ç±³é›¨è½¦é©¬é±¼é¸ŸçŠ¬ä¹¦æœ¬å­¦æ ¡è¯­è¨€æœ‹å‹å®¶å›½çˆ±è°¢è¯­é—®ç­”æ¥åŽ»è§åƒå–å¼€å…³æ˜Žæš—é£Žç”µæ°”èŠ±è‰æ ‘æžœæ˜Ÿæµ·äº‘å¤©åœ°äººå­—"];
    function charsForLevel(level, count=30){
      const start = (level*7) % baseChars.length;
      return Array.from({length:count}, (_,i)=> baseChars[(start+i)%baseChars.length]);
    }
    function makeData(from,to){
      const levels = {};
      for(let lv=from; lv<=to; lv++){
        levels[lv] = charsForLevel(lv, 30).map((ch,i)=>({
          id:`L${lv}_${i}`, char: ch,
          progress: Math.floor(Math.random()*101),
          locked: i%11===0
        }));
      }
      return levels;
    }
    const DATA = makeData(from,to);

    /* ------ Rendering ------ */
    const levelsWrap = document.getElementById('levelsWrap');
    const statusSel = document.getElementById('statusSel');
    const bigTiles = document.getElementById('bigTiles');
    const sortLevelBtn = document.getElementById('sortLevel');
    const sortAlphaBtn = document.getElementById('sortAlpha');
    const toTop = document.getElementById('toTop');
    const compactBtn = document.getElementById('compactBtn');
    const expandAllBtn = document.getElementById('expandAll');
    const collapseAllBtn = document.getElementById('collapseAll');

    function statusOf(item){
      if(item.locked) return 'locked';
      if(item.progress>=90) return 'done';
      if(item.progress<=5)  return 'new';
      return 'learn';
    }

    function levelProgress(items){
      const avg = Math.round(items.reduce((a,b)=>a+b.progress,0) / Math.max(1,items.length));
      return avg;
    }

    function render(){
      document.documentElement.style.setProperty('--tile', bigTiles.checked ? '104px' : '88px');
      document.documentElement.style.setProperty('--tileFont', bigTiles.checked ? '42px' : '36px');

      levelsWrap.innerHTML='';
      let total=0;

      // Jump chips
      const jump = document.getElementById('levelJump'); jump.innerHTML='';
      for(let lv=from; lv<=to; lv++){
        const a=document.createElement('a'); a.href=`#level-${lv}`; a.className='chip'; a.textContent=lv;
        jump.appendChild(a);
      }

      const order=[...Array(to-from+1)].map((_,i)=>from+i);
      if(sortAlphaBtn.getAttribute('aria-pressed')==='true'){
        const all=[]; order.forEach(lv=> all.push(...DATA[lv].map(it=>({...it,_lv:lv}))));
        all.sort((a,b)=> a.char.localeCompare(b.char,'zh-Hans-u-co-stroke') || a._lv-b._lv);
        buildLevel(from, `All (${from}â€“${to})`, all);
        total=all.length;
      }else{
        order.forEach(lv=>{ buildLevel(lv, `Level ${lv}`, DATA[lv]); total+=DATA[lv].length; });
      }
      document.getElementById('itemCount').textContent = total;
    }

    function buildLevel(level, title, items){
      const section=document.createElement('section'); section.className='level'; section.id=`level-${level}`;

      const head=document.createElement('div'); head.className='level-head';
      const titleEl = document.createElement('div'); titleEl.className='level-title';
      titleEl.innerHTML=`<span>${title}</span> <span class="muted">Â· ${items.length} items</span>`;
      const actions = document.createElement('div'); actions.className='lvl-actions';
      const pWrap = document.createElement('div'); pWrap.className='progress';
      const avg = levelProgress(items);
      pWrap.innerHTML = `<span class="muted" style="font-weight:700">Progress</span>
                         <span class="pbar" aria-hidden="true"><span style="width:${avg}%"></span></span>
                         <span class="muted">${avg}%</span>`;
      const collapseBtn = document.createElement('button'); collapseBtn.className='mini'; collapseBtn.textContent='Collapse';
      actions.append(pWrap, collapseBtn);
      head.append(titleEl, actions);
      section.appendChild(head);

      const grid=document.createElement('div'); grid.className='grid';

      const filter=statusSel.value;
      const filtered=items.filter(it=>{
        const st=statusOf(it);
        if(filter==='all') return true;
        if(filter==='done') return st==='done';
        if(filter==='learn')return st==='learn';
        if(filter==='new')  return st==='new';
        return true;
      });

      filtered.forEach(it=>{
        const a=document.createElement('a');
        const st=statusOf(it);
        a.href=`item.html?id=${encodeURIComponent(it.id)}`;
        a.className='tile'+(it.locked?' locked':'')+(st==='done'?' learned':'');
        a.setAttribute('title', it.locked ? 'Locked â€” learn prerequisites first' : (st==='done'?'Learned':'In progress'));
        a.innerHTML=`
          <span class="glyph">${it.char}</span>
          <span class="tick">${it.locked?'ðŸ”’':'âœ“'}</span>
          <span class="meter"><span style="width:${it.locked?0:it.progress}%"></span></span>
        `;
        grid.appendChild(a);
      });

      if(!filtered.length){
        const empty=document.createElement('div'); empty.style.padding='14px'; empty.className='muted';
        empty.textContent='No items matching the current filter.'; grid.appendChild(empty);
      }

      section.appendChild(grid);
      levelsWrap.appendChild(section);

      // collapse/expand (stable text)
      collapseBtn.addEventListener('click', ()=>{
        const closed = grid.style.display==='none';
        grid.style.display = closed ? 'grid' : 'none';
        collapseBtn.textContent = closed ? 'Collapse' : 'Expand';
      });
    }

    /* ------ Controls ------ */
    statusSel.addEventListener('change', render);
    bigTiles.addEventListener('change', render);
    sortLevelBtn.addEventListener('click', ()=>{
      sortLevelBtn.setAttribute('aria-pressed','true');
      sortAlphaBtn.setAttribute('aria-pressed','false');
      render();
    });
    sortAlphaBtn.addEventListener('click', ()=>{
      sortAlphaBtn.setAttribute('aria-pressed','true');
      sortLevelBtn.setAttribute('aria-pressed','false');
      render();
    });

    // Compact spacing toggle
    let compact=false;
    compactBtn.addEventListener('click', ()=>{
      compact = !compact;
      compactBtn.textContent = compact ? 'Comfort' : 'Compact';
      document.documentElement.style.setProperty('--gap', compact ? '12px' : '18px');
      document.documentElement.style.setProperty('--tile', compact ? (bigTiles.checked?'96px':'84px') : (bigTiles.checked?'104px':'88px'));
      render();
    });

    // Expand/collapse all reliably after render
    expandAllBtn.addEventListener('click', ()=>{
      document.querySelectorAll('.level .grid').forEach(g=> g.style.display='grid');
      document.querySelectorAll('.level .lvl-actions .mini').forEach(b=> b.textContent='Collapse');
    });
    collapseAllBtn.addEventListener('click', ()=>{
      document.querySelectorAll('.level .grid').forEach(g=> g.style.display='none');
      document.querySelectorAll('.level .lvl-actions .mini').forEach(b=> b.textContent='Expand');
    });

    // Back-to-top
    const showTop = ()=> { if(window.scrollY > 420) toTop.classList.add('show'); else toTop.classList.remove('show'); };
    window.addEventListener('scroll', showTop);
    toTop.addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top:0, behavior:'smooth'}); });

    /* ------ Init ------ */
    function init(){ initTheme(); render(); showTop(); }
    init();
  </script>
</body>
</html>
