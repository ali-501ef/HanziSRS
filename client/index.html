<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Hanzi SRS — Dashboard" />
  <meta name="theme-color" content="#0b0f19" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <title>Hanzi SRS — Dashboard</title>

  <style>
    /* --- Reset & tokens --- */
    *,*::before,*::after{box-sizing:border-box}
    body,h1,h2,h3,h4,p,figure,blockquote,dl,dd{margin:0}
    img,svg,video,canvas,audio,iframe{display:block;max-width:100%}
    input,button,textarea,select{font:inherit}
    :root{color-scheme:dark light}
    :root{
      --bg:#0b0f19; --bg-2:#0e1423; --text:#e5e7eb; --muted:#98a2b3;
      --surface:rgba(255,255,255,.04); --surface-2:rgba(255,255,255,.06); --border:rgba(255,255,255,.12);
      --accent:hsl(257 90% 66%); --accent-2:hsl(190 90% 60%); --success:#22c55e; --warn:#f59e0b; --danger:#ef4444;
      --shadow:0 10px 30px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.2);
      --radius:16px; --container:1200px; --gap:24px; --tile-h:82px;
    }
    @media (prefers-color-scheme: light){
      :root{--bg:#ffffff; --bg-2:#f7f9fc; --text:#0b1220; --muted:#5b6573; --surface:rgba(0,0,0,.04); --surface-2:rgba(0,0,0,.06); --border:rgba(17,24,39,.12);
      --shadow:0 10px 30px rgba(2,6,23,.08),0 2px 8px rgba(2,6,23,.06)}
    }
    html[data-theme="light"]{
      --bg:#ffffff; --bg-2:#f7f9fc; --text:#0b1220; --muted:#5b6573; --surface:rgba(0,0,0,.04); --surface-2:rgba(0,0,0,.06); --border:rgba(17,24,39,.12);
      --shadow:0 10px 30px rgba(2,6,23,.08),0 2px 8px rgba(2,6,23,.06)
    }
    html[data-theme="dark"]{
      --bg:#0b0f19; --bg-2:#0e1423; --text:#e5e7eb; --muted:#98a2b3; --surface:rgba(255,255,255,.04); --surface-2:rgba(255,255,255,.06); --border:rgba(255,255,255,.12);
      --shadow:0 10px 30px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.2)
    }

    body{
      min-height:100vh; background:var(--bg); color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", "PingFang SC","Hiragino Sans GB","Microsoft YaHei","Helvetica Neue", Arial;
      text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased; line-height:1.5;
    }
    .bg-wrap{position:fixed; inset:0; z-index:-1; overflow:hidden;
      background:
        radial-gradient(1200px 480px at 85% -10%, color-mix(in oklab, var(--accent), transparent 70%), transparent 75%),
        radial-gradient(900px 360px at 0% 0%, color-mix(in oklab, var(--accent-2), transparent 75%), transparent 75%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 40%, var(--bg) 100%);
    }
    .bg-grid{position:absolute; inset:-1px; background:
      linear-gradient(transparent 97%, var(--border) 100%) 0 0 / 40px 40px,
      linear-gradient(90deg, transparent 97%, var(--border) 100%) 0 0 / 40px 40px;
      mask-image: radial-gradient(80% 60% at 50% 10%, #000 0%, #000 60%, transparent 85%); opacity:.35}

    .container{max-width:var(--container); margin-inline:auto; padding-inline: clamp(16px, 3vw, 32px)}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .stack{display:flex; flex-direction:column; gap:10px}
    .grid{display:grid; gap:var(--gap)}
    .grid-2{grid-template-columns: 1.25fr .75fr}
    @media (max-width:820px){ .grid-2{grid-template-columns:1fr} }

    /* NAV + top controls */
    .nav{position:sticky; top:0; z-index:70; backdrop-filter: blur(12px);
      background: color-mix(in oklab, var(--bg), transparent 55%); border-bottom:1px solid var(--border)}
    .nav-inner{height:64px; display:flex; align-items:center; justify-content:space-between}
    .brand{display:flex; gap:10px; align-items:center; color:inherit; text-decoration:none; font-weight:800}
    .brand-badge{width:32px; height:32px; display:grid; place-items:center; border-radius:10px; color:white;
      background:linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow:var(--shadow)}
    .mini-badge{font-size:.75rem; padding:4px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted)}
    .btn{display:inline-flex; align-items:center; gap:10px; border:1px solid var(--border); background:var(--surface);
      padding:10px 14px; border-radius:12px; color:var(--text); text-decoration:none; cursor:pointer; font-weight:700; transition:transform .15s ease}
    .btn:hover{transform:translateY(-1px)} .btn:active{transform:none}
    .btn.ghost{background:transparent}

    /* Top menus (Hanzi / Vocab / Radicals) */
    .menu-wrap{position:relative; isolation:isolate}
    .nav-toggle{
      --glow: 0 8px 24px rgba(0,0,0,.12);
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:var(--surface);
      font-weight:800; transition: box-shadow .25s, background .25s, color .25s, transform .15s;
      box-shadow: var(--glow);
    }
    .nav-toggle:hover{transform:translateY(-1px)}
    .nav-toggle[aria-expanded="true"]{
      background:linear-gradient(90deg, var(--accent), var(--accent-2)); color:white; border:none;
      box-shadow: 0 12px 36px color-mix(in oklab, var(--accent) 60%, transparent);
    }
    .chev{transition: transform .25s cubic-bezier(.2,.8,.2,1)}
    .nav-toggle[aria-expanded="true"] .chev{transform:rotate(180deg)}
    .menu{
      position:absolute; top:46px; left:0; min-width:320px; max-width:520px;
      background:color-mix(in oklab, var(--bg), transparent 6%); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow);
      padding:12px; opacity:0; transform: translateY(-6px) scale(.98); visibility:hidden; pointer-events:none;
      transition: opacity .22s ease, transform .22s ease, visibility .22s; transform-origin: top center;
      backdrop-filter: blur(8px);
    }
    .menu.open{opacity:1; transform: translateY(0) scale(1); visibility:visible; pointer-events:auto}
    .menu-title{font-weight:900; margin:4px 6px 10px}
    .chips{
      display:grid; gap:8px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    @media (max-width:640px){ .chips{grid-template-columns: repeat(2, minmax(0, 1fr))} }
    .chip{
      display:inline-flex; justify-content:center; align-items:center; gap:8px; padding:10px 12px; border-radius:12px;
      border:1px solid var(--border); background:var(--surface); color:var(--text); text-decoration:none; font-weight:700;
      transition: transform .15s ease, background .2s ease, border-color .2s ease;
      white-space:nowrap;
    }
    .chip:hover{transform:translateY(-1px); background:var(--surface-2)}
    .chip:active{transform:none}

    /* Panels & cards */
    .panel{background:linear-gradient(180deg, var(--surface-2), transparent); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:16px}
    .card{background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:var(--shadow)}
    .muted{color:var(--muted)}
    .pill{padding:6px 10px; border:1px solid var(--border); border-radius:999px}
    h1{font-size:clamp(1.4rem, 2.6vw, 1.8rem); font-weight:800}
    h2{font-size:clamp(1.1rem, 2vw, 1.4rem); font-weight:800}

    /* Big action buttons */
    .actions{display:grid; grid-template-columns: 1fr 1fr; gap:16px}
    @media (max-width:580px){ .actions{grid-template-columns:1fr} }
    .action-card{
      position:relative; overflow:hidden; border-radius:20px; padding:18px; color:white; text-decoration:none;
      display:grid; grid-template-columns: 1fr auto; align-items:center; gap:16px; box-shadow:var(--shadow); isolation:isolate;
    }
    .action-card .label{font-weight:800; font-size:clamp(1.35rem,3vw,1.7rem)}
    .action-card .sub{opacity:.9}
    .action-card .count{font-size:clamp(1.6rem, 4vw, 2.1rem); font-weight:900}
    .action-card .cta{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; font-weight:700; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.25)}
    .action-card:hover{transform:translateY(-2px)}
    .action-card::before{content:""; position:absolute; inset:-1px; border-radius:inherit; z-index:-1; background: conic-gradient(from 180deg, rgba(255,255,255,.35), transparent 30%, rgba(255,255,255,.25), transparent 70%); filter: blur(22px)}
    .action-rev{background:linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%)}
    .action-les{background:linear-gradient(135deg, #10b981 0%, #06b6d4 100%)}
    .pulse{position:absolute; right:-40px; top:-40px; width:160px; height:160px; border-radius:50%; background:radial-gradient(circle at center, rgba(255,255,255,.18), transparent 60%); filter: blur(6px); pointer-events:none}

    /* Forecast */
    .seg{display:flex; gap:8px}
    .seg button{padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:var(--surface); cursor:pointer}
    .seg button[aria-pressed="true"]{background:linear-gradient(90deg, var(--accent), var(--accent-2)); color:white; border:none}
    canvas{width:100%; height:200px}

    /* Streak heatline */
    .heatline{display:grid; grid-auto-flow:column; gap:4px; align-items:end}
    .heatline .bar{width:8px; border-radius:4px; background:linear-gradient(180deg, var(--accent), var(--accent-2)); height:10px; opacity:.5}

    /* Queue health ring */
    .ring{--pct:0; --col:var(--accent); width:120px; height:120px; border-radius:50%;
      background:conic-gradient(var(--col) calc(var(--pct)*1%), var(--surface-2) 0); display:grid; place-items:center}
    .ring span{background:var(--bg); border:1px solid var(--border); border-radius:50%; width:84px; height:84px; display:grid; place-items:center; font-weight:800}

    /* Upcoming (collapsible, all closed by default) */
    .up-accordion details{border:1px solid var(--border); border-radius:12px; background:var(--surface)}
    .up-accordion details + details{margin-top:8px}
    .up-accordion summary{list-style:none; cursor:pointer; padding:10px 12px; display:flex; justify-content:space-between; align-items:center}
    .up-accordion summary::-webkit-details-marker{display:none}
    .up-accordion .sum-left{display:flex; gap:8px; align-items:center}
    .caret{transition: transform .2s ease}
    details[open] .caret{transform: rotate(90deg)}
    .up-list{display:grid; gap:8px; padding:10px 12px; border-top:1px solid var(--border); max-height:240px; overflow:auto}
    .up-row{display:flex; justify-content:space-between; border:1px solid var(--border); border-radius:10px; padding:8px 10px; background:var(--bg-2)}
    .up-row .time{font-variant-numeric:tabular-nums}

    /* Items grid (area selector inside the card) */
    .level-toolbar{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:6px}
    .seg-mini{display:flex; gap:6px}
    .seg-mini button{padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:var(--surface); cursor:pointer}
    .seg-mini button[aria-pressed="true"]{background:linear-gradient(90deg, var(--accent), var(--accent-2)); color:white; border:none}

    .level-grid{margin-top:10px; display:grid; gap:12px; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr))}
    .hanzi-item{display:grid; gap:6px}
    .hanzi-tile{
      display:grid; place-items:center; height:var(--tile-h); border-radius:14px; background:var(--surface);
      border:1px solid var(--border); font-weight:900; font-size:28px; text-decoration:none; color:var(--text); position:relative;
    }
    .hanzi-tile .due-dot{position:absolute; top:6px; right:6px; width:6px; height:6px; border-radius:999px; background:var(--warn)}
    .meter{height:6px; background:var(--surface-2); border:1px solid var(--border); border-radius:999px; overflow:hidden}
    .meter > span{display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent-2))}

    /* Settings sheet (reworked) */
    .sheet{position:fixed; top:0; right:0; width:min(520px, 100vw); height:100%; background:color-mix(in oklab, var(--bg), transparent 12%); backdrop-filter: blur(10px); border-left:1px solid var(--border); box-shadow:var(--shadow); transform:translateX(100%); transition: transform .25s ease; z-index:80; padding:16px}
    .sheet.open{transform:none}
    .section{display:grid; gap:10px; margin-top:12px}
    .field{display:grid; gap:6px}
    .field input, .field select{background:var(--bg-2); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px}
    .toggle{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:var(--surface)}
    .actions-row{display:flex; gap:8px; flex-wrap:wrap}

    /* Footer */
    footer{border-top:1px solid var(--border); margin-top:28px; padding:22px 0; color:var(--muted); font-size:.95rem}
  </style>
</head>
<body>
  <div class="bg-wrap" aria-hidden="true"><div class="bg-grid"></div></div>

  <!-- NAV + top toggles -->
  <nav class="nav" aria-label="Primary">
    <div class="container nav-inner">
      <a class="brand" href="#">
        <span class="brand-badge" aria-hidden="true">汉</span>
        <span>Hanzi SRS</span>
        <span class="mini-badge">Dashboard</span>
      </a>

      <div class="row">
        <!-- Proper toggles: closed by default; animated menus -->
        <div class="menu-wrap">
          <button id="btnHanziMenu" class="nav-toggle" aria-expanded="false" aria-controls="menuHanzi">
            Hanzi <svg class="chev" width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="m6 9 6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </button>
          <div id="menuHanzi" class="menu" role="menu" aria-label="Hanzi level ranges">
            <div class="menu-title">Hanzi levels</div>
            <div id="chipsHanzi" class="chips"></div>
          </div>
        </div>

        <div class="menu-wrap">
          <button id="btnVocabMenu" class="nav-toggle" aria-expanded="false" aria-controls="menuVocab">
            Vocabulary <svg class="chev" width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="m6 9 6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </button>
          <div id="menuVocab" class="menu" role="menu" aria-label="Vocabulary level ranges">
            <div class="menu-title">Vocabulary levels</div>
            <div id="chipsVocab" class="chips"></div>
          </div>
        </div>

        <div class="menu-wrap">
          <button id="btnRadMenu" class="nav-toggle" aria-expanded="false" aria-controls="menuRad">
            Radicals <svg class="chev" width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="m6 9 6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </button>
          <div id="menuRad" class="menu" role="menu" aria-label="Radicals level ranges">
            <div class="menu-title">Radicals levels</div>
            <div id="chipsRad" class="chips"></div>
          </div>
        </div>

        <button id="themeBtn" class="btn" title="Toggle theme" aria-label="Toggle theme">
          <svg id="themeIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 3v2m0 14v2m9-9h-2M5 12H3m14.95 6.95-1.41-1.41M7.46 7.46 6.05 6.05m12.9 0-1.41 1.41M7.46 16.54l-1.41 1.41" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Theme
        </button>
        <button id="openSettings" class="btn" title="Settings" aria-label="Open settings">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8Zm8 4a7.96 7.96 0 0 0-.34-2.29l2.11-1.54-2-3.46-2.46 1a8.03 8.03 0 0 0-3.95-2.3l-.37-2.6h-4l-.37 2.6a8.03 8.03 0 0 0-3.95 2.3l-2.46-1-2 3.46 2.11 1.54A8.1 8.1 0 0 0 4 12c0 .8.12 1.58.34 2.29l-2.11 1.54 2 3.46 2.46-1a8.03 8.03 0 0 0 3.95 2.3l.37 2.6h4l.37-2.6a8.03 8.03 0 0 0 3.95-2.3l2.46 1 2-3.46-2.11-1.54c.22-.71.34-1.49.34-2.29Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
          Settings
        </button>
      </div>
    </div>
  </nav>

  <main id="main" class="container" style="margin-top:18px">
    <!-- HERO -->
    <section class="panel">
      <div class="row" style="justify-content:space-between">
        <h1>Welcome back<span id="comma">,</span> <span id="userName">Learner</span></h1>
        <div class="row muted">
          <span class="pill">Streak: <strong id="streakDays">—</strong> days</span>
          <span class="pill">Local time: <strong id="localTime">—:—</strong></span>
        </div>
      </div>
      <div class="actions" style="margin-top:14px">
        <!-- The reviews button should link directly to the reviews page. When clicked it will navigate to reviews.html -->
        <a href="reviews.html" class="action-card action-rev" aria-label="Start reviews">
          <div class="stack">
            <span class="label">Reviews</span>
            <span class="sub">Due now</span>
            <span class="cta">Start <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>
          </div>
          <div class="stack" style="align-items:flex-end">
            <span class="count" id="dueNow">—</span>
            <span class="sub" id="revEta">≈ —</span>
          </div>
          <div class="pulse" aria-hidden="true"></div>
        </a>

        <!-- The lessons button should link directly to the lessons page. When clicked it will navigate to lessons.html -->
        <a href="lessons.html" class="action-card action-les" aria-label="Start lessons">
          <div class="stack">
            <span class="label">New lessons</span>
            <span class="sub">Available</span>
            <span class="cta">Begin <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>
          </div>
          <div class="stack" style="align-items:flex-end">
            <span class="count" id="lessonsAvail">—</span>
            <span class="sub" id="lesEta">≈ —</span>
          </div>
          <div class="pulse" aria-hidden="true"></div>
        </a>
      </div>
    </section>

    <!-- MAIN GRID -->
    <section class="grid grid-2" style="margin-top:16px">
      <!-- LEFT -->
      <div class="stack">
        <!-- Forecast -->
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <div class="stack">
              <h2>Review forecast</h2>
              <div class="row muted">
                <span>Next hour: <strong id="nextHour">—</strong></span>
                <span>Today: <strong id="todayTotal">—</strong></span>
                <span>Tomorrow: <strong id="tomorrowTotal">—</strong></span>
              </div>
            </div>
            <div class="seg" role="tablist" aria-label="Forecast mode">
              <button id="modeHours" role="tab" aria-selected="true" aria-pressed="true">Hours</button>
              <button id="modeDays" role="tab" aria-selected="false" aria-pressed="false">Days</button>
            </div>
          </div>
          <div style="margin-top:10px">
            <canvas id="forecast" aria-label="Reviews forecast"></canvas>
          </div>
        </div>

        <!-- Quick links -->
        <div class="card">
          <h2>Quick links</h2>
          <div class="row" style="margin-top:8px">
            <!-- Ensure the quick link buttons navigate to the correct pages when clicked -->
            <a class="btn" href="reviews.html">Start reviews</a>
            <a class="btn" href="lessons.html">Start lessons</a>
            <a class="btn" href="#" id="btnManage">Manage decks</a>
            <a class="btn" href="#" id="btnSettings">Settings</a>
          </div>
        </div>

        <!-- Items (search removed; area toggle remains) -->
        <div class="card">
          <div class="level-toolbar">
            <div class="row"><strong id="levelTitle">Current level</strong><span class="muted" id="lvlLabel"> · Hanzi · Level 3</span></div>
            <div class="seg-mini" role="tablist" aria-label="Content type">
              <button id="areaHanzi"   role="tab" aria-pressed="true"  aria-selected="true">Hanzi</button>
              <button id="areaVocab"   role="tab" aria-pressed="false" aria-selected="false">Vocabulary</button>
              <button id="areaRadical" role="tab" aria-pressed="false" aria-selected="false">Radicals</button>
            </div>
          </div>
          <div id="levelGrid" class="level-grid" aria-live="polite"></div>
        </div>

        <!-- Activity -->
        <div class="card">
          <h2>Recent activity</h2>
          <div id="activity" class="stack" style="margin-top:8px"></div>
        </div>
      </div>

      <!-- RIGHT SIDEBAR -->
      <aside class="stack">
        <!-- Queue health -->
        <div class="card">
          <h2>Queue health</h2>
          <div class="row" style="margin-top:8px; justify-content:space-between">
            <div class="ring" id="healthRing" style="--pct:0; --col:var(--success)"><span id="healthPct">—%</span></div>
            <div class="stack">
              <div class="row"><span class="pill">Apprentice</span><strong id="cAp">—</strong></div>
              <div class="row"><span class="pill">Guru</span><strong id="cGu">—</strong></div>
              <div class="row"><span class="pill">Master</span><strong id="cMa">—</strong></div>
              <div class="row"><span class="pill">Enlightened</span><strong id="cEn">—</strong></div>
              <div class="row"><span class="pill">Burned</span><strong id="cBu">—</strong></div>
            </div>
          </div>
        </div>

        <!-- Streak -->
        <div class="card">
          <h2>Streak</h2>
          <div class="heatline" id="heatline" style="margin-top:10px"></div>
          <p class="muted" style="margin-top:6px">Reviews completed over the last 14 days.</p>
        </div>

        <!-- Upcoming (all collapsed initially) -->
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <h2>Upcoming</h2>
            <span class="muted" id="tzLabel">—</span>
          </div>
          <div id="upcomingAcc" class="up-accordion" style="margin-top:10px"></div>
        </div>

        <!-- Starred -->
        <div class="card">
          <h2>Starred items</h2>
          <div id="starredList" class="stack" style="margin-top:8px"></div>
        </div>
      </aside>
    </section>
  </main>

  <!-- SETTINGS SHEET -->
  <aside id="settingsSheet" class="sheet" aria-label="Settings" aria-hidden="true">
    <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:6px">
      <h3>Settings</h3>
      <button id="closeSettings" class="btn" aria-label="Close settings">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        Close
      </button>
    </div>

    <div class="section">
      <strong>Account</strong>
      <div class="field"><label>Name<input id="accName" type="text" value="Learner"></label></div>
      <div class="field"><label>Email<input id="accEmail" type="email" value="learner@example.com"></label></div>
      <div class="actions-row">
        <a class="btn" href="profile.html">Edit profile</a>
        <a class="btn" href="security.html">Change password</a>
      </div>
    </div>

    <div class="section">
      <strong>Billing</strong>
      <div class="row"><span class="pill">Plan</span><span>Annual — Pro</span></div>
      <div class="row"><span class="pill">Renews</span><span>2026-01-08</span></div>
      <div class="row"><span class="pill">Payment</span><span>Visa •••• 4242</span></div>
      <div class="actions-row">
        <a class="btn" href="billing.html">Manage billing</a>
        <a class="btn" href="invoices.html">Invoices</a>
      </div>
    </div>

    <div class="section">
      <strong>Notifications</strong>
      <div class="toggle"><div><b>Reviews due</b><div class="muted">Daily summary, morning</div></div><label><input type="checkbox" checked></label></div>
      <div class="toggle"><div><b>Lesson unlocks</b><div class="muted">When new lessons become available</div></div><label><input type="checkbox" checked></label></div>
      <div class="toggle"><div><b>Streak reminders</b><div class="muted">Nudge if no reviews by evening</div></div><label><input type="checkbox"></label></div>
    </div>

    <div class="section">
      <strong>Data & Privacy</strong>
      <div class="actions-row">
        <button class="btn" id="btnExport">Export data (CSV)</button>
        <button class="btn danger" id="btnDelete">Delete account</button>
      </div>
    </div>

    <div class="section">
      <strong>Connected services</strong>
      <div class="row"><span class="pill">Sign-in</span><span>Google</span></div>
      <div class="actions-row">
        <a class="btn" href="connections.html">Manage connections</a>
        <a class="btn ghost" href="logout.html">Log out</a>
      </div>
    </div>
  </aside>

  <footer class="container">
    <div class="row" style="justify-content:space-between">
      <span class="muted">© <span id="year"></span> Hanzi SRS</span>
      <span class="muted">Shortcuts: <span class="kbd">R</span> reviews · <span class="kbd">L</span> lessons · <span class="kbd">T</span> theme</span>
    </div>
  </footer>

  <script>
    /* ---------------------------
       Demo data (replace with API)
    ----------------------------*/
    const profile = {
      name: 'Learner', level: 3, streak: 14, dueNow: 42, lessons: 9,
      srsCounts: {appr: 128, guru: 76, master: 45, enl: 22, burn: 10},
      recent: [
        {time:'Just now', text:'Finished 12 reviews (92% correct)'},
        {time:'1h ago', text:'Learned 3 new characters: 汉, 字, 学'},
        {time:'Yesterday', text:'Burned 2 items'}
      ],
      starred: [{char:'谢', pin:'xiè', mean:'thank'}, {char:'语', pin:'yǔ', mean:'language'}, {char:'爱', pin:'ài', mean:'love'}],
      heat: Array.from({length:14}, ()=> Math.floor(Math.random()*30)+1)
    };
    // Items
    const dataHanzi = [
      {label:'汉', progress:55, dueInH:1},{label:'字',progress:35,dueInH:4},{label:'学',progress:72,dueInH:26},
      {label:'谢',progress:20,dueInH:0},{label:'好',progress:88,dueInH:72},{label:'语',progress:40,dueInH:6},
      {label:'国',progress:65,dueInH:5},{label:'人',progress:92,dueInH:120},{label:'日',progress:80,dueInH:30},
      {label:'中',progress:96,dueInH:240},{label:'大',progress:50,dueInH:12},{label:'小',progress:10,dueInH:0},
      {label:'天',progress:70,dueInH:18},{label:'水',progress:45,dueInH:9},{label:'火',progress:38,dueInH:3},
      {label:'山',progress:12,dueInH:0},{label:'口',progress:68,dueInH:14},{label:'手',progress:44,dueInH:7},
      {label:'目',progress:48,dueInH:8},{label:'女',progress:15,dueInH:0},{label:'子',progress:76,dueInH:40},
      {label:'心',progress:33,dueInH:2},{label:'言',progress:85,dueInH:54}
    ];
    const dataVocab   = [{label:'汉语',progress:42,dueInH:3},{label:'学习',progress:60,dueInH:8},{label:'谢谢',progress:25,dueInH:0},{label:'语言',progress:58,dueInH:20},{label:'学校',progress:71,dueInH:36}];
    const dataRadical = [{label:'氵',progress:90,dueInH:120},{label:'讠',progress:75,dueInH:36},{label:'宀',progress:62,dueInH:12},{label:'女',progress:80,dueInH:48},{label:'子',progress:66,dueInH:24}];

    /* ---------------------------
       DOM refs
    ----------------------------*/
    const els = {
      year: document.getElementById('year'),
      userName: document.getElementById('userName'),
      streakDays: document.getElementById('streakDays'),
      localTime: document.getElementById('localTime'),
      dueNow: document.getElementById('dueNow'),
      lessonsAvail: document.getElementById('lessonsAvail'),
      revEta: document.getElementById('revEta'),
      lesEta: document.getElementById('lesEta'),

      // Nav menus
      btnHanziMenu: document.getElementById('btnHanziMenu'),
      btnVocabMenu: document.getElementById('btnVocabMenu'),
      btnRadMenu:   document.getElementById('btnRadMenu'),
      menuHanzi: document.getElementById('menuHanzi'),
      menuVocab: document.getElementById('menuVocab'),
      menuRad:   document.getElementById('menuRad'),
      chipsHanzi: document.getElementById('chipsHanzi'),
      chipsVocab: document.getElementById('chipsVocab'),
      chipsRad:   document.getElementById('chipsRad'),

      // Forecast
      canvas: document.getElementById('forecast'),
      modeHours: document.getElementById('modeHours'),
      modeDays:  document.getElementById('modeDays'),
      nextHour: document.getElementById('nextHour'),
      todayTotal: document.getElementById('todayTotal'),
      tomorrowTotal: document.getElementById('tomorrowTotal'),

      // Items card
      levelTitle: document.getElementById('levelTitle'),
      lvlLabel: document.getElementById('lvlLabel'),
      levelGrid: document.getElementById('levelGrid'),
      areaHanzi: document.getElementById('areaHanzi'),
      areaVocab: document.getElementById('areaVocab'),
      areaRadical: document.getElementById('areaRadical'),

      // Activity / sidebar
      activity: document.getElementById('activity'),
      healthRing: document.getElementById('healthRing'),
      healthPct: document.getElementById('healthPct'),
      cAp: document.getElementById('cAp'), cGu: document.getElementById('cGu'),
      cMa: document.getElementById('cMa'), cEn: document.getElementById('cEn'), cBu: document.getElementById('cBu'),
      heatline: document.getElementById('heatline'),
      upcomingAcc: document.getElementById('upcomingAcc'),
      tzLabel: document.getElementById('tzLabel'),
      starredList: document.getElementById('starredList'),

      // Top nav actions
      themeBtn: document.getElementById('themeBtn'),
      themeIcon: document.getElementById('themeIcon'),
      openSettings: document.getElementById('openSettings'),
      settingsSheet: document.getElementById('settingsSheet'),
      closeSettings: document.getElementById('closeSettings'),

      // Settings actions
      btnExport: document.getElementById('btnExport'),
      btnDelete: document.getElementById('btnDelete')
    };

    /* ---------------------------
       Theme + header basics
    ----------------------------*/
    const THEME_KEY='hanziSRS_theme';
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    function applyTheme(next){
      localStorage.setItem(THEME_KEY, next);
      document.documentElement.setAttribute('data-theme', next==='auto' ? (prefersDark?'dark':'light') : next);
      els.themeIcon.innerHTML = (document.documentElement.getAttribute('data-theme')==='dark')
        ? '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z" stroke="currentColor" stroke-width="2" fill="none"/>'
        : '<path d="M12 3v2m0 14v2m9-9h-2M5 12H3m14.95 6.95-1.41-1.41M7.46 7.46 6.05 6.05m12.9 0-1.41 1.41M7.46 16.54l-1.41 1.41" stroke="currentColor" stroke-width="2" fill="none"/>';
    }
    function initTheme(){ applyTheme(localStorage.getItem(THEME_KEY) || 'auto') }
    els.themeBtn.addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme') || (prefersDark?'dark':'light');
      applyTheme(cur==='dark' ? 'light' : 'dark');
    });

    function pad(n){ return String(n).padStart(2,'0') }
    function tickClock(){ const d=new Date(); document.getElementById('localTime').textContent=`${pad(d.getHours())}:${pad(d.getMinutes())}` }
    setInterval(tickClock, 1000);
    document.getElementById('year').textContent = new Date().getFullYear();
    els.userName.textContent = profile.name;
    els.streakDays.textContent = profile.streak;
    els.dueNow.textContent = profile.dueNow;
    els.lessonsAvail.textContent = profile.lessons;
    els.revEta.textContent = eta(profile.dueNow);
    els.lesEta.textContent = eta(profile.lessons);
    els.lvlLabel.textContent = ` · Hanzi · Level ${profile.level}`;
    function eta(count){ if(!count) return '≈ 0m'; const secs = Math.round(count*9); const m=Math.floor(secs/60), s=secs%60; return `≈ ${m}m${s?` ${s}s`:''}` }

    /* ---------------------------
       Top menus (level ranges) — closed by default; animated
    ----------------------------*/
    const groupSize = 10; // 1–10, 11–20, …

    function buildChips(area, container){
      const maxLevel=60; container.innerHTML='';
      for(let from=1; from<=maxLevel; from+=groupSize){
        const to=Math.min(from+groupSize-1, maxLevel);
        const a=document.createElement('a'); a.className='chip';
        a.href=`levels.html?area=${encodeURIComponent(area)}&from=${from}&to=${to}`;
        a.textContent=`${from}–${to}`; // arrow removed per request
        container.appendChild(a);
      }
    }
    buildChips('hanzi', els.chipsHanzi);
    buildChips('vocab', els.chipsVocab);
    buildChips('radicals', els.chipsRad);

    function closeAllMenus(){
      [['btnHanziMenu','menuHanzi'],['btnVocabMenu','menuVocab'],['btnRadMenu','menuRad']].forEach(([b,m])=>{
        document.getElementById(b).setAttribute('aria-expanded','false');
        document.getElementById(m).classList.remove('open');
      });
    }
    function toggleMenu(btn, menu){
      const expanded = btn.getAttribute('aria-expanded')==='true';
      closeAllMenus();
      if(!expanded){ btn.setAttribute('aria-expanded','true'); menu.classList.add('open') }
    }
    els.btnHanziMenu.addEventListener('click', ()=>toggleMenu(els.btnHanziMenu, els.menuHanzi));
    els.btnVocabMenu.addEventListener('click', ()=>toggleMenu(els.btnVocabMenu, els.menuVocab));
    els.btnRadMenu.addEventListener('click',   ()=>toggleMenu(els.btnRadMenu,   els.menuRad));
    document.addEventListener('click', (e)=>{
      const inMenu = e.target.closest('.menu-wrap');
      if(!inMenu) closeAllMenus();
    });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeAllMenus() });

    /* ---------------------------
       Activity & sidebar basics
    ----------------------------*/
    els.activity.innerHTML='';
    profile.recent.forEach(r=>{
      const row=document.createElement('div'); row.className='row';
      row.innerHTML=`<span class="pill">${r.time}</span><span>${r.text}</span>`;
      els.activity.appendChild(row);
    });

    ['cAp','cGu','cMa','cEn','cBu'].forEach((k,i)=>{
      const keys=['appr','guru','master','enl','burn']; els[k].textContent = profile.srsCounts[keys[i]];
    });
    const totalSrs = Object.values(profile.srsCounts).reduce((a,b)=>a+b,0);
    const healthy = Math.max(0, Math.min(100, 100 - Math.round((profile.srsCounts.appr / Math.max(1,totalSrs)) * 100)));
    els.healthPct.textContent = healthy + '%';
    els.healthRing.style.setProperty('--pct', healthy);
    els.healthRing.style.setProperty('--col', healthy>70?'var(--success)': healthy>40?'var(--warn)':'var(--danger)');

    els.heatline.innerHTML='';
    const maxHeat = Math.max(...profile.heat);
    profile.heat.forEach(v=>{
      const b=document.createElement('div'); b.className='bar';
      const h = 8 + (v/maxHeat)*36; b.style.height=h+'px'; b.style.opacity=0.35+(v/maxHeat)*0.65;
      els.heatline.appendChild(b);
    });

    // Starred
    function buildStarred(){
      els.starredList.innerHTML='';
      profile.starred.forEach(s=>{
        const row=document.createElement('div'); row.className='row';
        row.innerHTML=`<span class="pill" style="font-weight:800">${s.char}</span><span>${s.pin}</span><span class="muted">${s.mean}</span>`;
        els.starredList.appendChild(row);
      });
    }
    buildStarred();

    /* ---------------------------
       Forecast (no libs)
    ----------------------------*/
    const ctx = document.getElementById('forecast').getContext('2d');
    const forecastHours = Array.from({length:24}, (_,i)=> Math.max(0, Math.round( (Math.sin((i-6)/3)+1.15)*12 + (i%6===0?8:0) )));
    const forecastDays  = Array.from({length:7}, (_,i)=> [36,54,42,68,50,32,28][i] );
    let currentForecast = 'hours';
    els.modeHours.addEventListener('click', ()=>setForecast('hours'));
    els.modeDays.addEventListener('click', ()=>setForecast('days'));

    function setForecast(mode){
      currentForecast = mode;
      els.modeHours.setAttribute('aria-pressed', mode==='hours'); els.modeHours.setAttribute('aria-selected', mode==='hours');
      els.modeDays.setAttribute('aria-pressed', mode==='days'); els.modeDays.setAttribute('aria-selected', mode==='days');
      drawForecast(); updateForecastBadges();
    }
    function updateForecastBadges(){
      const nextHour = forecastHours[0] ?? 0;
      const today = forecastHours.reduce((a,b)=>a+b,0);
      const tomorrow = forecastDays[1] ?? 0;
      els.nextHour.textContent = nextHour;
      els.todayTotal.textContent = today;
      els.tomorrowTotal.textContent = tomorrow;
    }
    function drawForecast(){
      const dpr = window.devicePixelRatio || 1;
      const canvas = document.getElementById('forecast');
      const w = canvas.clientWidth, h = 220;
      canvas.width = w*dpr; canvas.height = h*dpr; canvas.style.height = h+'px';
      ctx.setTransform(dpr,0,0,dpr,0,0); ctx.clearRect(0,0,w,h);
      const data = currentForecast==='hours' ? forecastHours : forecastDays;
      const padding = {l: 28, r: 10, t: 10, b: 26};
      const plotW = w - padding.l - padding.r; const plotH = h - padding.t - padding.b;
      const maxY = Math.max(10, ...data); const stepX = plotW / (data.length-1 || 1);
      // grid
      ctx.strokeStyle = getCss('--border'); ctx.lineWidth=1; ctx.globalAlpha=.7;
      for(let i=0;i<=4;i++){ const y = padding.t + (plotH/4)*i; ctx.beginPath(); ctx.moveTo(padding.l, y); ctx.lineTo(w-padding.r, y); ctx.stroke() }
      ctx.globalAlpha=1;
      // line
      ctx.beginPath(); ctx.lineWidth=2;
      const grad = ctx.createLinearGradient(padding.l,0,w-padding.r,0);
      grad.addColorStop(0, getCss('--accent')); grad.addColorStop(1, getCss('--accent-2')); ctx.strokeStyle=grad;
      data.forEach((v,i)=>{ const x=padding.l+i*stepX; const y=padding.t+plotH-(v/maxY)*plotH; if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y) });
      ctx.stroke();
      // area
      const fill = ctx.createLinearGradient(0,padding.t,0, h-padding.b);
      fill.addColorStop(0, hexToRgba(getCss('--accent'), .3)); fill.addColorStop(1, hexToRgba(getCss('--accent-2'), .05));
      ctx.lineTo(padding.l + (data.length-1)*stepX, h-padding.b); ctx.lineTo(padding.l, h-padding.b); ctx.closePath(); ctx.fillStyle = fill; ctx.fill();
      // labels
      ctx.fillStyle = getCss('--muted'); ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto'; ctx.textAlign='center';
      const labels = currentForecast==='hours'
        ? ['Now','+3h','+6h','+9h','+12h','+15h','+18h','+21h']
        : ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      const steps = labels.length-1;
      labels.forEach((lab,i)=>{ const x = padding.l + (plotW/steps)*i; const y = h - 8; ctx.fillText(lab, x, y) });
    }
    function getCss(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim() }
    function hexToRgba(hex, a){
      if(hex.startsWith('rgb')) return hex.replace(')', `, ${a})`).replace('rgb(', 'rgba(');
      const m = hex.replace('#',''); const int = parseInt(m.length===3 ? m.split('').map(c=>c+c).join('') : m, 16);
      const r=(int>>16)&255, g=(int>>8)&255, b=int&255; return `rgba(${r}, ${g}, ${b}, ${a})`;
    }
    window.addEventListener('resize', drawForecast);

    /* ---------------------------
       Upcoming (next 4 days) — all collapsed initially
    ----------------------------*/
    const HOURS_AHEAD = 24*4; // 4 days
    function genHourlySchedule(n){
      const out=[]; for(let i=0;i<n;i++){
        const now=Date.now(); const ts=now+i*60*60*1000; const h=new Date(ts).getHours();
        const base=Math.max(0, Math.round((Math.sin((h-6)/3)+1.12)*8)); const bump=(i%6===0)?4:0; const noise=Math.round((Math.random()-0.5)*2);
        out.push({ts, count: Math.max(0, base+bump+noise)});
      } return out;
    }
    const hourly = genHourlySchedule(HOURS_AHEAD);

    function buildUpcoming(){
      els.tzLabel.textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;
      els.upcomingAcc.innerHTML='';
      const byDay = {};
      for(const e of hourly){
        const d = new Date(e.ts); const key = d.toLocaleDateString();
        (byDay[key] ||= []).push(e);
      }
      const keys = Object.keys(byDay).slice(0,4);
      keys.forEach((key)=>{
        const list = byDay[key]; const total = list.reduce((a,b)=>a+b.count,0);
        const details = document.createElement('details'); // closed by default
        const dayLabel = new Date(list[0]?.ts || Date.now()).toLocaleDateString(undefined,{weekday:'long', month:'short', day:'numeric'});
        details.innerHTML = `
          <summary>
            <div class="sum-left">
              <svg class="caret" width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="m9 6 6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
              <strong>${dayLabel}</strong>
            </div>
            <span class="pill">Total: <strong>${total}</strong></span>
          </summary>
        `;
        const ul = document.createElement('div'); ul.className='up-list';
        list.filter(x=>x.count>0).forEach(e=>{
          const t = new Date(e.ts).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
          const row = document.createElement('div'); row.className='up-row';
          row.innerHTML = `<span class="time">${t}</span><span class="count">${e.count}</span>`;
          ul.appendChild(row);
        });
        if(!ul.children.length){ ul.innerHTML = `<div class="muted">No reviews predicted.</div>` }
        details.appendChild(ul);
        els.upcomingAcc.appendChild(details);
      });
    }

    /* ---------------------------
       Items card (area selector)
    ----------------------------*/
    let itemArea = 'hanzi'; // 'hanzi' | 'vocab' | 'radicals'
    function setItemArea(area){
      itemArea = area;
      els.areaHanzi.setAttribute('aria-pressed', area==='hanzi'); els.areaHanzi.setAttribute('aria-selected', area==='hanzi');
      els.areaVocab.setAttribute('aria-pressed', area==='vocab'); els.areaVocab.setAttribute('aria-selected', area==='vocab');
      els.areaRadical.setAttribute('aria-pressed', area==='radicals'); els.areaRadical.setAttribute('aria-selected', area==='radicals');
      const label = area==='hanzi' ? 'Hanzi' : area==='vocab' ? 'Vocabulary' : 'Radicals';
      els.lvlLabel.textContent = ` · ${label} · Level ${profile.level}`;
      buildLevelGrid();
    }
    els.areaHanzi.addEventListener('click', ()=>setItemArea('hanzi'));
    els.areaVocab.addEventListener('click', ()=>setItemArea('vocab'));
    els.areaRadical.addEventListener('click', ()=>setItemArea('radicals'));

    function dataset(){ return itemArea==='hanzi' ? dataHanzi : itemArea==='vocab' ? dataVocab : dataRadical }

    function buildLevelGrid(){
      const data = dataset();
      els.levelGrid.innerHTML='';
      if(!data.length){ els.levelGrid.innerHTML = `<div class="muted">Nothing to show.</div>`; return }
      data.forEach(it=>{
        const wrap = document.createElement('div'); wrap.className='hanzi-item';
        const a = document.createElement('a'); a.href='#'; a.className='hanzi-tile';
        a.textContent = it.label;
        if(it.dueInH!=null && it.dueInH<=24){ const dot=document.createElement('span'); dot.className='due-dot'; dot.title='Due within 24h'; a.appendChild(dot) }
        const meter=document.createElement('div'); meter.className='meter';
        const fill=document.createElement('span'); fill.style.width=Math.max(0,Math.min(100,it.progress))+'%';
        meter.appendChild(fill);
        wrap.appendChild(a); wrap.appendChild(meter);
        els.levelGrid.appendChild(wrap);
      });
    }

    /* ---------------------------
       Settings sheet (open/close + simple actions)
    ----------------------------*/
    function openSheet(){ els.settingsSheet.classList.add('open'); els.settingsSheet.setAttribute('aria-hidden','false') }
    function closeSheet(){ els.settingsSheet.classList.remove('open'); els.settingsSheet.setAttribute('aria-hidden','true') }
    document.getElementById('openSettings').addEventListener('click', openSheet);
    document.getElementById('closeSettings').addEventListener('click', closeSheet);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeSheet() });
    document.addEventListener('click', (e)=>{ if(els.settingsSheet.classList.contains('open')){ const inside=e.target.closest('.sheet, #openSettings'); if(!inside) closeSheet() }});
    if(els.btnExport) els.btnExport.addEventListener('click', ()=>alert('Export started (demo).'));
    if(els.btnDelete) els.btnDelete.addEventListener('click', ()=>confirm('Delete your account? This cannot be undone. (demo)'));

    /* ---------------------------
       Init
    ----------------------------*/
    function init(){
      tickClock(); initTheme();
      // Forecast
      setForecast('hours'); drawForecast();
      // Upcoming (all collapsed by default)
      buildUpcoming();
      // Items card
      setItemArea('hanzi'); buildLevelGrid();
      // Footer-only shortcuts
      document.addEventListener('keydown', (e)=>{
        if(e.key.toLowerCase()==='r') location.href='reviews.html';
        if(e.key.toLowerCase()==='l') location.href='lessons.html';
        if(e.key.toLowerCase()==='t') document.getElementById('themeBtn').click();
      });
    }
    init();
  </script>
</body>
</html>
